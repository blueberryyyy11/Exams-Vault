Structured computer organization. CPU, RAM (SRAM vs DRAM), Buses (PCIe, I2C, UART, USB, ATA/SATA), Serial vs Parallel Bus, external storage devices (EEPROM, SSD, HDD, NVME, Flash), clock generators. Hardware/software interrupts and I/O mechanisms. Bootloading process.

## CPU

 ЦПУ (**Центральный процессор**) является «мозгом» компьютера. Его функция заключается в выполнении программ, хранящихся в основной памяти, путем извлечения их инструкций, анализа и последующего выполнения их одну за другой. Компоненты соединены шиной, которая представляет собой набор параллельных проводов для передачи адресов, данных и управляющих сигналов. Шины могут быть внешними для ЦПУ, соединяя его с памятью и устройствами ввода-вывода, но также и внутренними, как мы увидим далее.

ЦПУ состоит из нескольких отдельных частей. Устройство управления отвечает за извлечение инструкций из основной памяти и определение их типа. Арифметико-логическое устройство выполняет такие операции, как сложение и логическое И, необходимые для выполнения инструкций.

Организация простого компьютера с шиной показана на рисунке 2-1.
![[Pasted image 20250119160443.png]]

ЦПУ также содержит небольшую высокоскоростную память, используемую для хранения временных результатов и определенной управляющей информации. Эта память состоит из набора регистров, каждый из которых имеет определенный размер и функцию. Обычно все регистры имеют одинаковый размер. Каждый регистр может хранить одно число, максимум которого определяется размером регистра. Регистры можно читать и записывать с высокой скоростью, так как они являются внутренними для ЦПУ.

Чтобы повысить производительность, разработчики ЦПУ давно отказались от простой модели извлечения, декодирования и выполнения одной инструкции за раз. Многие современные процессоры имеют возможность выполнять более одной инструкции одновременно. Например, процессор может иметь отдельные блоки для извлечения, декодирования и выполнения инструкций, так что во время выполнения инструкции n он может также декодировать инструкцию n + 1 и извлекать инструкцию n + 2. Такая организация называется *конвейером* (pipeline).

---

## SRAM vs DRAM

Память, которую мы рассматривали до сих пор, можно как читать, так и записывать. Такая память называется **ОЗУ** (оперативное запоминающее устройство, или RAM – Random Access Memory), что является не совсем корректным термином, так как все микросхемы памяти предоставляют произвольный доступ. Однако термин слишком укоренился, чтобы его изменить. ОЗУ бывает двух видов: статическая и динамическая.

Основная память занимает следующее место в иерархии. Она является рабочей лошадкой памяти. **Основная память обычно называется ОЗУ** (Random Access Memory). Старожилы иногда называют её ферритовой памятью, так как компьютеры 1950-х и 1960-х годов использовали крошечные магнитные ферритовые сердечники для хранения данных. Эти технологии исчезли десятилетия назад, но название сохранилось. В настоящее время объём памяти достигает сотен мегабайт и даже нескольких гигабайт, и продолжает быстро расти. Все запросы процессора, которые не могут быть удовлетворены из кэша, направляются в основную память.

**Статическая ОЗУ (SRAM)** – более быстрая и дорогая, создаётся на основе схем, подобных базовому D-триггеру. Эти памяти обладают свойством сохранять своё содержимое, пока на них подаётся питание: секунды, минуты, часы и даже дни. Статическая память работает очень быстро. Типичное время доступа составляет несколько наносекунд. По этой причине статическая ОЗУ популярна **в качестве памяти уровня 2 (L2) в кэше**.

**Динамическая ОЗУ (DRAM)** – медленнее и дешевле, не использует триггеры. Вместо этого динамическая память представляет собой массив ячеек, каждая из которых содержит один транзистор и крошечный **конденсатор**. Конденсаторы могут заряжаться или разряжаться, что позволяет хранить 0 и 1. Однако из-за утечки электрического заряда каждая ячейка в динамической памяти должна обновляться (перезагружаться) каждые несколько миллисекунд, чтобы предотвратить утечку данных. Поскольку для обновления требуется внешняя логика, динамическая ОЗУ требует более сложного интерфейса, чем статическая. Однако в большинстве случаев этот недостаток компенсируется её большей ёмкостью.

---

## Шины (Buses)

Шина — это общий электрический путь между несколькими устройствами. Шины можно классифицировать по их функциям. Они могут использоваться внутри ЦПУ для передачи данных к и от арифметико-логического устройства (АЛУ) или снаружи ЦПУ, для подключения его к памяти или устройствам ввода-вывода. Каждый тип шин имеет свои собственные требования и свойства. В этом разделе и последующих мы сосредоточимся на шинах, которые соединяют ЦПУ с памятью и устройствами ввода-вывода. В следующей главе мы более подробно рассмотрим внутренние шины ЦПУ.

В ранних персональных компьютерах была одна внешняя шина или системная шина. Она состояла из 50–100 параллельных медных проводов, выгравированных на материнской плате, с разъёмами, расположенными через равные интервалы для подключения модулей памяти и устройств ввода-вывода.

Современные персональные компьютеры, как правило, имеют специализированную шину между ЦПУ и памятью и (по крайней мере) ещё одну шину для устройств ввода-вывода. Простейшая система с одной шиной памяти и одной шиной ввода-вывода показана на рисунке 3-35.
![[Pasted image 20250119162058.png]]


#### **PCIe** (Peripheral Component Interconnect Express):

Высокоскоростная последовательная шина для расширения компьютеров. Представьте себе её как супербыструю магистраль, по которой данные перемещаются, соединяя, например, графические карты и SSD.

#### **I2C** (Inter-Integrated Circuit):

Последовательная шина связи, подходящая для подключения низкоскоростных периферийных устройств, таких как датчики.

#### **UART** (Universal Asynchronous Receiver-Transmitter):

Стандарт последовательной связи для подключения устройств. Представьте себе два рации, обменивающихся сообщениями.

#### **USB** (Universal Serial Bus):

Стандарт последовательной шины для подключения устройств, таких как клавиатуры, принтеры и внешние накопители.

#### **ATA/SATA** (Advanced Technology Attachment / Serial ATA):

SATA — последовательная шина для подключения устройств хранения данных, таких как жёсткие диски.

#### **Последовательные и параллельные шины**

- **Параллельные шины** передают несколько бит одновременно, как команда, которая совместно переносит груз. Примером может быть старый порт для принтеров.
- **Последовательные шины** передают данные бит за битом.


#### **Архитектура параллельной шины**

В традиционных шинах PCI передача каждого слова данных осуществляется по нескольким проводам. Например, в обычных PCI-шинах одно 32-битное число передаётся по 32 параллельным проводам.

В отличие от этого, PCIe использует **архитектуру последовательной шины** и передаёт все биты сообщения через одно соединение, называемое линией (lane), подобно сетевому пакету. Это значительно упрощает процесс, так как не нужно обеспечивать одновременное прибытие всех 32 бит в пункт назначения. Однако параллелизм всё же используется: можно задействовать несколько линий одновременно. Например, можно использовать 32 линии для передачи 32 сообщений параллельно.

---

## Устройства хранения данных
![[Pasted image 20250119163217.png]]
#### **ОЗУ (RAM)**

ОЗУ (оперативная память) — это не единственный вид микросхем памяти. Во многих приложениях, таких как игрушки, бытовая техника и автомобили, программы и некоторые данные должны сохраняться даже при выключении питания. Более того, после установки программы и данные обычно не изменяются. Эти требования привели к разработке **ПЗУ (постоянной памяти, или ROM)**, которая не может быть изменена или случайно удалена. Данные в ПЗУ записываются на этапе производства с использованием специальной маски, формирующей требуемый шаблон битов.

Однако ПЗУ имеет свои ограничения: после производства данные изменить невозможно, а создание маски требует значительных затрат времени и денег. Для решения этой проблемы была создана **ПРОМ (программируемая память, или PROM)**, которая может быть записана (единожды) уже после изготовления.

#### **ЭПРОМ (Erasable PROM)**

Следующим шагом стало создание **ЭПРОМ (стираемой программируемой памяти)**, которую можно не только записывать, но и стирать. Для этого используется ультрафиолетовый свет. Если в процессе проектирования требуется частое внесение изменений, ЭПРОМ оказывается более экономичным вариантом, так как его можно многократно использовать.

#### **Электрически стираемая ПЗУ (EEPROM)**

EEPROM стирается электрическими импульсами, что удобнее, чем использование ультрафиолета. Она может быть перепрограммирована на месте, в отличие от ЭПРОМ, который требует специального устройства для записи. Однако EEPROM значительно уступает по скорости и объёму оперативной памяти (ОЗУ), а также является более дорогой.

#### **Флэш-память**

Флэш-память является более современной разновидностью EEPROM. Она может стираться блоками и перепрограммироваться без удаления из схемы. Флэш-память широко используется в портативных устройствах, таких как цифровые камеры и музыкальные плееры. Однако у неё есть ограничение: она изнашивается после примерно 100,000 циклов записи/стирания.

#### **Жёсткие диски (HDD)**

Следующим уровнем в иерархии хранения данных являются магнитные диски.
![[Pasted image 20250119163240.png]]Жёсткие диски намного дешевле ОЗУ и имеют значительно больший объём. Однако они медленнее, так как представляют собой механическое устройство. Диск состоит из металлических пластин, вращающихся со скоростью 5400, 7200 или более оборотов в минуту. Информация записывается концентрическими кругами (дорожками), каждая из которых делится на сектора (обычно по 512 байт).

Перемещение механической головки между дорожками занимает 5–10 мс, а скорость чтения/записи варьируется от 50 до 160 МБ/с.

#### **Твердотельные накопители (SSD)**

SSD (твердотельные накопители, Solid State Disks) не имеют движущихся частей и используют флэш-память для хранения данных. Они долговечнее, тише и быстрее, чем HDD, но пока более дороги. Несмотря на название, они лишь имитируют жёсткие диски по объёму и энергонезависимости данных.

---

## Hardware and Software Interrupts

#### **Аппаратное обеспечение и программное обеспечение**

Программы, написанные на истинном машинном языке компьютера (уровень 1), могут выполняться непосредственно электронными схемами компьютера (уровень 0) без использования интерпретаторов или трансляторов. Эти электронные схемы, вместе с памятью и устройствами ввода-вывода, составляют **аппаратное обеспечение (hardware)** компьютера.  
**Аппаратное обеспечение** — это физические объекты: интегральные схемы, печатные платы, кабели, блоки питания, память и принтеры, а не абстрактные идеи или инструкции.

**Программное обеспечение (software)**, напротив, состоит из алгоритмов (детальных инструкций о том, как что-то делать) и их компьютерных представлений — программ. Программы могут храниться на жёстком диске, CD-ROM или других носителях, но суть программного обеспечения заключается в самих инструкциях, а не в физическом носителе.

---

#### **Прерывания**

**Аппаратные и программные прерывания** — это механизмы операционной системы, которые позволяют ЦПУ реагировать на конкретные события или запросы.

##### **Аппаратные прерывания: (Hardware Interrupts)**

- **Определение:**  
    Аппаратные прерывания — это сигналы, отправляемые внешними устройствами или внутренними компонентами для привлечения внимания ЦПУ.
- **Цель:**  
    Обработка срочных задач, таких как получение данных с периферийных устройств (клавиатуры, сетевых карт).
- **Примеры:**  
    Ввод с клавиатуры, движения мыши, завершение операций ввода-вывода.

---

##### **Программные прерывания: (Software Interrupts)**

- **Определение:**  
    Программные прерывания (также известные как исключения или ловушки) — это сигналы, создаваемые самим программным обеспечением для запроса услуг ОС или для индикации исключительных ситуаций.
- **Цель:**  
    Выполнение системных вызовов, обработка ошибок, управление исключительными ситуациями.
- **Примеры:**  
    Деление на ноль, системные вызовы, ошибки страницы памяти.

---
некоторые определения:
##### **Контроллер**

Контроллер — это аппаратное устройство, которое отвечает за управление работой периферийного оборудования, такого как жёсткие диски, клавиатуры, мыши, принтеры и другие устройства ввода/вывода. Контроллер находится между устройством и процессором (CPU), помогая передавать данные между ними.

**Основные функции контроллера:**

1. Преобразует сигналы и команды процессора в формат, понятный устройству.
2. Управляет передачей данных между устройством и памятью или процессором.
3. Сигнализирует системе о завершении операций (например, отправляет сигнал прерывания).
4. Поддерживает связь с драйвером устройства через регистры контроллера.

Примеры контроллеров:

- **Контроллер жесткого диска** (HDD Controller) управляет чтением и записью данных на жёсткий диск.
- **Графический контроллер** (GPU Controller) обрабатывает графические данные.
- **Сетевой контроллер** (Network Controller) управляет передачей данных через сеть.


##### **Драйвер**

Драйвер (или **драйвер устройства**) — это программное обеспечение, которое служит "переводчиком" между операционной системой и контроллером устройства. Он позволяет операционной системе и прикладным программам взаимодействовать с устройством, не зная его аппаратных деталей.

**Основные функции драйвера:**

1. Отправляет команды на контроллер устройства (например, «прочитать данные» или «распечатать документ»).
2. Обрабатывает ответы от устройства и передаёт их операционной системе.
3. Управляет особенностями устройства (например, настройка разрешения экрана для мониторов или скорости передачи данных для сетевых адаптеров).
4. Обеспечивает поддержку различных операционных систем для устройства.

Примеры драйверов:

- **Драйвер принтера** управляет печатью документов.
- **Драйвер видеокарты** (GPU driver) оптимизирует работу графики и поддерживает видеовывод.
- **Драйвер USB-устройства** обеспечивает взаимодействие с флешками, клавиатурами или мышами.


**Связь драйвера и контроллера**

Контроллер выполняет физическую работу с устройством (например, чтение данных с диска), а драйвер управляет контроллером, передавая ему команды и принимая от него данные.  
Драйвер — это "мозг", управляющий контроллером, который является "руками", взаимодействующими с устройством.

Если упростить:

- **Контроллер**: Аппаратное устройство, которое работает с периферийным оборудованием.
- **Драйвер**: Программа, которая управляет этим контроллером и делает его доступным для операционной системы.

#### **Обработка прерываний**

1. **Аппаратный механизм прерывания:**
    ![[Pasted image 20250119163930.png]]
    - Шаг 1: Драйвер отправляет контроллеру устройства команду через регистры устройства.
    - Шаг 2: После завершения операции контроллер сигнализирует контроллеру прерываний.
    - Шаг 3: Если контроллер прерываний готов, он отправляет сигнал ЦПУ.
    - Шаг 4: Контроллер прерываний сообщает ЦПУ, какое устройство завершило работу.
2. **Обработка прерывания ЦПУ:**
    ![[Pasted image 20250119164150.png]]
    - Сохранение счетчика команд (PC) и состояния процессора (PSW(*The PSW (Program Status Word) is a register in the CPU that contains information about the current state of the program being executed. It typically includes flags that indicate the status of certain operations, such as whether an arithmetic operation resulted in an overflow or whether a comparison operation was true or false. The PSW is used by the CPU to make decisions and control the flow of the program.)*) в стеке.
    - Переход в режим ядра.
    - Обработка сигнала прерывания с использованием обработчика прерываний, адрес которого находится в векторе прерываний.
    - После завершения обработки программа возвращается к следующей инструкции.


#### **Приоритеты прерываний**

Прерывания могут возникать в неудобные моменты, например, во время работы другого обработчика(interrupt handler). Для управления этим процессом:

- ЦПУ может отключать прерывания временно.
- Если прерывания отключены, устройства продолжают посылать сигналы, но ЦПУ их игнорирует до включения.
- При множественных прерываниях приоритет определяется статическими значениями, где устройства с высоким приоритетом обслуживаются первыми.


---

## input/output
Компьютерная система состоит из трех основных компонентов: процессора (CPU), памяти (основной и вторичной) и оборудования ввода/вывода (I/O), такого как принтеры, сканеры и модемы. Мы уже рассмотрели процессор и память, теперь настало время изучить устройства ввода/вывода и их подключение к системе.

#### **Драйверы устройств**

Каждый тип контроллера устройств требует уникального программного обеспечения для управления. Программа, которая взаимодействует с контроллером, отправляя команды и получая ответы, называется **драйвером устройства (device driver)**. Производитель контроллера должен предоставить драйвер для каждой поддерживаемой операционной системы.
![[Pasted image 20250119164547.png]]

#### **Методы выполнения операций ввода/вывода**

Операции ввода/вывода могут выполняться тремя различными способами:


##### **1. Ожидание занятости (Busy Waiting)**

- Пользовательская программа вызывает системный вызов, который ядро преобразует в вызов драйвера.
- Драйвер запускает устройство и **постоянно опрашивает его состояние**, чтобы определить, завершена ли операция (например, проверяет бит состояния устройства).
- После завершения операции драйвер помещает данные, если они есть, в нужное место и возвращает управление операционной системе.
- **Недостаток:** Этот метод занимает процессор, пока устройство не завершит свою работу.


##### **2. Прерывания (Interrupts)**

- Драйвер запускает устройство и настраивает его так, чтобы оно сгенерировало **прерывание** при завершении операции.
- После запуска устройства драйвер возвращается, а операционная система блокирует вызывающую программу и переключается на выполнение других задач.
- Когда контроллер завершает операцию, он генерирует **прерывание**, которое обрабатывается операционной системой.

##### Обработка прерываний:
![[Pasted image 20250119170130.png]]
1. Драйвер записывает команды в регистры устройства (Шаг 1).
2. После завершения операции контроллер устройства отправляет сигнал прерывания на контроллер прерываний (Шаг 2).
3. Если контроллер прерываний готов, он отправляет сигнал ЦПУ (Шаг 3).
4. Контроллер прерываний передает номер устройства ЦПУ для идентификации завершенного процесса (Шаг 4).

###### Дальнейшие действия ЦПУ:
![[Pasted image 20250119170142.png]]
- Счетчик команд (PC) и состояние процессора (PSW) сохраняются в стеке.
- Процессор переходит в режим ядра.
- Номер устройства используется для нахождения адреса обработчика прерываний в **векторе прерываний**.
- Обработчик(Interrupt handler) выполняет запрос к устройству, чтобы узнать его статус.
- После завершения обработки управление возвращается к пользовательской программе.


#### **3. Прямой доступ к памяти (DMA)**

- **DMA (Direct Memory Access)** — это специальный аппаратный компонент, который может управлять передачей данных между памятью и устройством без постоянного участия ЦПУ.
- ЦПУ настраивает чип DMA, указывая количество байтов, адреса памяти и устройства, а также направление передачи данных.
- После завершения передачи чип DMA генерирует прерывание, которое обрабатывается аналогично описанному выше.


#### **Преимущества прерываний и DMA**

- **Прерывания** позволяют процессору выполнять другие задачи, пока устройство завершает свою работу.
- **DMA** снижает нагрузку на процессор, полностью освобождая его от выполнения операций ввода/вывода.


---

## Bootloading (процесс загрузки)

#### **Общее объяснение**

Загрузка (bootloading) — это процесс, при котором компьютер инициализирует оборудование и загружает операционную систему (ОС) из памяти или других устройств хранения. Основные шаги этого процесса включают активацию базовых компонентов системы и запуск ОС.


#### **Шаги загрузки:**

1. **Инициализация BIOS:**
    - После включения компьютера запускается программа BIOS (**Basic Input Output System**), которая находится на материнской плате (или, как сказано шутливо, на "родительской плате").
    - BIOS проверяет:
        - Сколько оперативной памяти (RAM) установлено.
        - Подключены ли клавиатура и другие базовые устройства.
        - Какие устройства подключены через шины PCIe и PCI.
        
2. **Определение устройства загрузки:**
    - BIOS определяет, с какого устройства загрузить систему (например, USB, CD-ROM или жёсткий диск). Эта информация хранится в памяти CMOS, и пользователь может изменить приоритет устройств через настройки BIOS.
3. **Загрузка первого сектора (Boot Sector):**
    - BIOS считывает первый сектор (загрузочный сектор) выбранного устройства в оперативную память.
    - Этот сектор содержит небольшой **загрузчик (bootloader)**, который выполняет базовые задачи инициализации.
4. **Проверка таблицы разделов:**
    - Загрузчик анализирует таблицу разделов на конце загрузочного сектора. Эта таблица показывает, как организованы данные на устройстве хранения и какой раздел активен.
5. **Загрузка вторичного загрузчика:**
    - Из активного раздела загружается **вторичный загрузчик**, который более сложен. Он способен работать с файловой системой и загружать компоненты ОС.
6. **Запуск операционной системы:**
    - Вторичный загрузчик считывает ОС из активного раздела и передаёт ей управление.
    - ОС:
        - Считывает конфигурацию устройств через BIOS.
        - Ищет драйверы для всех обнаруженных устройств. Если драйверов нет, ОС может запросить их установку (например, с CD-ROM или через интернет).
        - Загружает драйверы в ядро.
        - Инициализирует системные таблицы, запускает фоновые процессы и отображает экран входа (или графический интерфейс).



#### **Объяснение для простоты:**

1. **Загрузка с USB или CD-ROM:**
    
    - Компьютер пытается загрузиться с внешних устройств, если они настроены как загрузочные.
2. **Чтение первого сектора (загрузочного сектора):**
    
    - Считывается небольшой загрузчик, который запускает начальную инициализацию.
3. **Проверка таблицы разделов:**
    
    - Загрузчик определяет активный раздел, из которого будет загружена ОС.
4. **Вторичный загрузчик:**
    
    - Вторичный загрузчик выполняет более сложные задачи, например, загружает ОС из файловой системы.
5. **Запуск ОС:**
    
    - ОС запускается, проверяет устройства и драйверы, а затем готовит систему к работе.


#### **Значение термина "boot":**

Слово "boot" происходит от термина "bootstrap" (подтянуть себя за ботинки). Оно символизирует процесс самозагрузки компьютера, начиная с базовых шагов до полного запуска ОС.